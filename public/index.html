<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>聊天室</title>
<style>
  :root {
    --sunset-yellow: #FFD54F;
    --light-red: #FF8A80;
    --warm-orange: #FFB74D;
    --cool-teal: #4DB6AC;
    --light-purple: #BA68C8;
    --light-pink: #F48FB1;
  }
  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, var(--sunset-yellow) 0%, var(--light-red) 20%, var(--warm-orange) 40%, var(--cool-teal) 60%, var(--light-purple) 80%, var(--light-pink) 100%);
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  .top-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: rgba(255,255,255,0.2);
    padding: 10px 15px;
    color: #fff;
    font-weight: bold;
    backdrop-filter: blur(5px);
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  }
  .top-center {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .top-center img {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid rgba(255,255,255,0.5);
  }
  .top-bar button {
    background: rgba(255,255,255,0.3);
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    font-size: 18px;
    cursor: pointer;
    color: #fff;
    transition: all 0.3s ease;
  }
  .top-bar button:hover {
    background: rgba(255,255,255,0.5);
    transform: scale(1.1);
  }
  #log {
    flex: 1;
    padding: 15px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
  }
  .msg {
    max-width: 70%;
    padding: 10px 15px;
    margin: 8px 0;
    border-radius: 18px;
    color: #333;
    background: rgba(255,255,255,0.8);
    word-wrap: break-word;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    animation: fadeIn 0.3s ease;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .me { 
    background: #DCF8C6; 
    align-self: flex-end; 
  }
  .other { 
    background: rgba(255,255,255,0.9); 
    align-self: flex-start; 
  }
  .system { 
    background: rgba(200,200,200,0.7); 
    text-align: center; 
    color: #000; 
    font-style: italic;
    max-width: 90%;
    margin: 8px auto;
  }
  .input-area {
    display: flex;
    padding: 15px;
    background: rgba(255,255,255,0.2);
    backdrop-filter: blur(5px);
    position: relative;
    gap: 10px;
  }
  #msg { 
    flex: 1; 
    padding: 12px 15px; 
    border: none; 
    border-radius: 24px; 
    outline: none; 
    font-size: 16px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  #sendBtn, #emojiBtn { 
    padding: 10px 20px; 
    border: none; 
    border-radius: 24px; 
    cursor: pointer; 
    background: rgba(255,255,255,0.9);
    font-weight: bold;
    transition: all 0.3s ease;
  }
  #sendBtn:hover, #emojiBtn:hover {
    background: rgba(255,255,255,1);
    transform: scale(1.05);
  }
  #sendBtn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }

  /* 表情面板 */
  #emojiPanel {
    position: absolute;
    bottom: 70px;
    right: 15px;
    background: rgba(255,255,255,0.95);
    border-radius: 12px;
    padding: 10px;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    width: 300px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    z-index: 100;
  }
  #emojiPanel button {
    font-size: 24px;
    border: none;
    background: none;
    cursor: pointer;
    padding: 5px;
    border-radius: 5px;
    transition: background 0.2s;
  }
  #emojiPanel button:hover {
    background: rgba(0,0,0,0.1);
  }
  /* 状态样式 */
  .status {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 14px;
    color: #fff;
  }
  .status-circle {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    animation: breathe 2s infinite ease-in-out;
  }

  @keyframes breathe {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.5); opacity: 0.6; }
  }

  /* 根据不同状态动态修改颜色和动画时间 */
  .online { background: #4CAF50; animation-duration: 2s; }
  .offline { background: #9E9E9E; animation-duration: 3s; }
  .busy { background: #FFC107; animation-duration: 1s; }
  
  /* 通话界面样式 */
  #callOverlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(10px);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }

  #callStatus {
    margin-bottom: 20px;
    color: #fff;
    font-size: 24px;
    text-align: center;
  }
  
  #callTimer {
    font-size: 28px;
    font-weight: bold;
    color: #fff;
    margin: 15px 0;
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
  }
  
  .call-buttons {
    display: flex;
    gap: 20px;
    margin-top: 30px;
  }
  
  .call-button {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: none;
    font-size: 24px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    transition: all 0.3s ease;
  }
  
  .call-button:hover {
    transform: scale(1.1);
  }
  
  #acceptCall {
    background: #4CAF50;
    color: white;
  }
  
  #endCall {
    background: #F44336;
    color: white;
  }
  
  .caller-info {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 30px;
  }
  
  .caller-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid white;
    margin-bottom: 15px;
  }
  
  .caller-name {
    color: white;
    font-size: 20px;
    font-weight: bold;
  }
</style>
</head>
<body>

<div class="top-bar">
  <button onclick="goHome()">🏠</button>
  <div class="top-center">
    <img id="partnerAvatar" src="https://ui-avatars.com/api/?name=User&background=random" alt="对方头像">
    <span id="partnerName">未知用户</span>
    <div id="partnerStatus" class="status">
      <div id="statusCircle" class="status-circle offline"></div>
      <span id="statusText">离线</span>
    </div>
  </div>
  <button onclick="startCall()">📞</button>
</div>

<div id="log">
  <div class="msg system">欢迎来到聊天室！请输入您的昵称开始聊天。</div>
</div>

<div class="input-area">
  <input id="msg" placeholder="输入消息..." />
  <button id="emojiBtn" onclick="toggleEmojiPanel()">😊</button>
  <button id="sendBtn" onclick="sendMessage()" disabled>发送</button>
</div>

<script>
  // 简化版本 - 移除有问题的复杂功能
  document.addEventListener('DOMContentLoaded', function() {
    // 初始化变量
    let userName = '';
    let partnerInfo = { 
      name: "未知用户", 
      avatar: "https://ui-avatars.com/api/?name=User&background=random", 
      online: false 
    };
    
    // 请求用户输入名称
    getUserName();
    
    // 设置事件监听器
    document.getElementById('msg').addEventListener('input', function() {
      const sendBtn = document.getElementById('sendBtn');
      sendBtn.disabled = this.value.trim() === '';
    });
    
    document.getElementById('msg').addEventListener('keypress', function(e) {
      if (e.key === 'Enter' && !sendBtn.disabled) {
        sendMessage();
      }
    });
    
    // 模拟连接状态变化
    simulateConnectionStatus();
  });
  
  // 获取用户名
  function getUserName() {
    let name = '';
    while(!name || name.trim() === '') {
      name = prompt("请输入你的昵称:") || "匿名用户";
    }
    window.userName = name;
    addSystemMessage(`你好，${name}! 这是一个演示版本，部分功能可能无法使用。`);
  }
  
  // 添加系统消息
  function addSystemMessage(message) {
    const logDiv = document.getElementById("log");
    const msgDiv = document.createElement("div");
    msgDiv.className = "msg system";
    msgDiv.textContent = message;
    logDiv.appendChild(msgDiv);
    logDiv.scrollTop = logDiv.scrollHeight;
  }
  
  // 发送消息
  function sendMessage() {
    const msgInput = document.getElementById("msg");
    const message = msgInput.value.trim();
    
    if (!message) return;
    
    // 添加自己的消息到聊天记录
    addMessage(message, 'me');
    
    // 模拟对方回复（仅演示用）
    if (Math.random() > 0.5) {
      setTimeout(() => {
        const replies = [
          "你好！",
          "很高兴收到你的消息！",
          "我现在无法回复，稍后联系你。",
          "谢谢你的消息！",
          "这是一个自动回复。"
        ];
        const randomReply = replies[Math.floor(Math.random() * replies.length)];
        addMessage(randomReply, 'other');
        setPartnerStatus('online');
      }, 1000 + Math.random() * 2000);
    }
    
    // 清空输入框
    msgInput.value = '';
    document.getElementById('sendBtn').disabled = true;
  }
  
  // 添加消息到聊天记录
  function addMessage(message, type) {
    const logDiv = document.getElementById("log");
    const msgDiv = document.createElement("div");
    msgDiv.className = `msg ${type}`;
    msgDiv.textContent = message;
    logDiv.appendChild(msgDiv);
    logDiv.scrollTop = logDiv.scrollHeight;
  }
  
  // 设置对方状态
  function setPartnerStatus(state) {
    const circle = document.getElementById("statusCircle");
    const text = document.getElementById("statusText");
    
    circle.className = "status-circle " + state;
    
    if (state === "online") {
      text.textContent = "在线";
      partnerInfo.online = true;
    } else if (state === "offline") {
      text.textContent = "离线";
      partnerInfo.online = false;
    } else if (state === "busy") {
      text.textContent = "繁忙";
      partnerInfo.online = true;
    }
  }
  
  // 模拟连接状态变化
  function simulateConnectionStatus() {
    setInterval(() => {
      const states = ["online", "offline", "busy"];
      const randomState = states[Math.floor(Math.random() * states.length)];
      setPartnerStatus(randomState);
    }, 10000);
  }
  
  // 表情面板功能
  function toggleEmojiPanel() {
    let panel = document.getElementById('emojiPanel');
    
    if (panel) { 
      panel.remove(); 
      return; 
    }
    
    panel = document.createElement('div');
    panel.id = 'emojiPanel';
    
    const emojis = ['😀', '😃', '😄', '😁', '😆', '😅', '😂', '🤣', '😊', '😇', '🙂', '🙃', '😉', '😌', '😍', '🥰', '😘', '😗', '😙', '😚', '😋', '😛', '😝', '😜', '🤪', '🤨', '🧐', '🤓', '😎', '🤩', '🥳', '😏', '😒', '😞', '😔', '😟', '😕', '🙁', '☹️', '😣', '😖', '😫', '😩', '🥺', '😢', '😭', '😤', '😠', '😡', '🤬', '🤯', '😳', '🥵', '🥶', '😱', '😨', '😰', '😥', '😓', '🫣', '🤗', '🫡', '🤔', '🫢', '🤭', '🤫', '🤥', '😶', '🫠', '😐', '🫤', '😑', '😬', '🙄', '😯', '😦', '😧', '😮', '😲', '🥱', '😴', '🤤', '😪', '😵', '🫥', '🤐', '🥴', '🤢', '🤮', '🤧', '😷', '🤒', '🤕', '🤑', '🤠', '😈', '👿', '👹', '👺', '🤡', '💩', '👻', '💀', '☠️', '👽', '👾', '🤖', '🎃', '😺', '😸', '😹', '😻', '😼', '😽', '🙀', '😿', '😾'];
    
    emojis.forEach(emoji => {
      const btn = document.createElement('button');
      btn.innerText = emoji;
      btn.onclick = () => insertEmoji(emoji);
      panel.appendChild(btn);
    });
    
    document.querySelector('.input-area').appendChild(panel);
  }
  
  // 插入表情
  function insertEmoji(symbol) {
    const msgInput = document.getElementById("msg");
    msgInput.value += symbol;
    msgInput.focus();
    document.getElementById('sendBtn').disabled = false;
  }
  
  // 主页按钮功能
  function goHome() {
    if (confirm("确定要离开聊天室吗？")) {
      addSystemMessage("您已离开聊天室");
      // 在实际应用中这里会进行断开连接等操作
    }
  }
  
  // 开始通话功能（简化版）
  function startCall() {
    if (!partnerInfo.online) {
      alert("对方不在线，无法发起通话");
      return;
    }
    
    if (confirm("确定要发起语音通话吗？")) {
      showCallOverlay(false);
      addSystemMessage("已发起通话请求...");
      
      // 模拟对方在10秒后接听
      setTimeout(() => {
        if (Math.random() > 0.3) {
          document.getElementById('callStatus').textContent = "通话中...";
          startCallTimer();
        } else {
          endCall();
          addSystemMessage("对方拒绝了通话请求");
        }
      }, 3000);
    }
  }
  
  // 显示通话界面
  function showCallOverlay(isIncoming) {
    const overlay = document.createElement('div');
    overlay.id = 'callOverlay';
    
    const callerInfo = document.createElement('div');
    callerInfo.className = 'caller-info';
    
    const avatar = document.createElement('img');
    avatar.src = partnerInfo.avatar;
    avatar.alt = partnerInfo.name;
    avatar.className = 'caller-avatar';
    
    const name = document.createElement('div');
    name.className = 'caller-name';
    name.textContent = partnerInfo.name;
    
    callerInfo.appendChild(avatar);
    callerInfo.appendChild(name);
    
    const status = document.createElement('div');
    status.id = 'callStatus';
    status.textContent = isIncoming ? '来电中...' : '呼叫中...';
    
    const timer = document.createElement('div');
    timer.id = 'callTimer';
    timer.textContent = '00:00:00';
    
    const buttons = document.createElement('div');
    buttons.className = 'call-buttons';
    
    if (isIncoming) {
      const acceptBtn = document.createElement('button');
      acceptBtn.id = 'acceptCall';
      acceptBtn.innerHTML = '📞';
      acceptBtn.title = '接听';
      acceptBtn.onclick = acceptCall;
      buttons.appendChild(acceptBtn);
    }
    
    const endBtn = document.createElement('button');
    endBtn.id = 'endCall';
    endBtn.innerHTML = '📞';
    endBtn.title = '挂断';
    endBtn.onclick = endCall;
    buttons.appendChild(endBtn);
    
    overlay.appendChild(callerInfo);
    overlay.appendChild(status);
    overlay.appendChild(timer);
    overlay.appendChild(buttons);
    
    document.body.appendChild(overlay);
  }
  
  // 接听通话
  function acceptCall() {
    document.getElementById('callStatus').textContent = "通话中...";
    startCallTimer();
    addSystemMessage("已接听通话");
  }
  
  // 结束通话
  function endCall() {
    const overlay = document.getElementById('callOverlay');
    if (overlay) {
      overlay.remove();
    }
    stopCallTimer();
    addSystemMessage("通话已结束");
  }
  
  // 通话计时器变量
  let callTimerInterval = null;
  let callStartTime = null;
  
  // 启动通话计时器
  function startCallTimer() {
    // 清除现有的计时器（如果有）
    if (callTimerInterval) {
      clearInterval(callTimerInterval);
    }
    
    // 记录通话开始时间
    callStartTime = new Date();
    
    // 更新计时器显示
    updateCallTimer();
    
    // 每秒更新一次计时器
    callTimerInterval = setInterval(updateCallTimer, 1000);
  }

  // 更新通话计时器显示
  function updateCallTimer() {
    const timerElement = document.getElementById('callTimer');
    if (!timerElement) return;
    
    // 计算通话时长（秒）
    const now = new Date();
    const elapsedSeconds = Math.floor((now - callStartTime) / 1000);
    
    // 格式化为HH:MM:SS
    const hours = Math.floor(elapsedSeconds / 3600);
    const minutes = Math.floor((elapsedSeconds % 3600) / 60);
    const seconds = elapsedSeconds % 60;
    
    // 更新显示
    timerElement.textContent = 
      `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
  }

  // 停止通话计时器
  function stopCallTimer() {
    if (callTimerInterval) {
      clearInterval(callTimerInterval);
      callTimerInterval = null;
    }
  }
</script>

</body>
</html>
