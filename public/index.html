<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<title>èŠå¤©å®¤</title>
<style>
  :root {
    --sunset-yellow: #FFD54F;
    --light-red: #FF8A80;
    --warm-orange: #FFB74D;
    --cool-teal: #4DB6AC;
    --light-purple: #BA68C8;
    --light-pink: #F48FB1;
  }
  body {
    margin: 0;
    font-family: sans-serif;
    background: linear-gradient(135deg, var(--sunset-yellow) 0%, var(--light-red) 20%, var(--warm-orange) 40%, var(--cool-teal) 60%, var(--light-purple) 80%, var(--light-pink) 100%);
    height: 100vh;
    display: flex;
    flex-direction: column;
  }
  /* é¡¶éƒ¨æ  */
  .top-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: rgba(255,255,255,0.2);
    padding: 10px;
    color: #fff;
    font-weight: bold;
    backdrop-filter: blur(5px);
  }
  .top-bar button {
    background: none;
    border: none;
    font-size: 20px;
    cursor: pointer;
    color: #fff;
  }
  /* æ¶ˆæ¯åŒºåŸŸ */
  #log {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
  }
  .msg {
    max-width: 70%;
    padding: 8px 12px;
    margin: 5px 0;
    border-radius: 12px;
    color: #000;
    background: rgba(255,255,255,0.8);
    word-wrap: break-word;
  }
  .me {
    background: rgba(255,255,255,0.9);
    align-self: flex-end;
  }
  .other {
    background: rgba(255,255,255,0.6);
    align-self: flex-start;
  }
  /* è¾“å…¥åŒº */
  .input-area {
    display: flex;
    padding: 10px;
    background: rgba(255,255,255,0.2);
    backdrop-filter: blur(5px);
  }
  #msg {
    flex: 1;
    padding: 8px;
    border: none;
    border-radius: 20px;
    outline: none;
  }
  #sendBtn, #emojiBtn {
    margin-left: 5px;
    padding: 8px 12px;
    border: none;
    border-radius: 20px;
    cursor: pointer;
    background: rgba(255,255,255,0.9);
  }
</style>
</head>
<body>

<!-- é¡¶éƒ¨æ  -->
<div class="top-bar">
  <button onclick="window.location.href='/'">ğŸ </button>
  <div id="status">å¯¹æ–¹ï¼šç¦»çº¿</div>
  <button onclick="startCall()">ğŸ“</button>
</div>

<!-- æ¶ˆæ¯è®°å½• -->
<div id="log" style="display:flex;flex-direction:column;"></div>

<!-- è¾“å…¥æ¡† -->
<div class="input-area">
  <input id="msg" placeholder="è¾“å…¥æ¶ˆæ¯..." />
  <button id="emojiBtn" onclick="insertEmoji()">ğŸ˜Š</button>
  <button id="sendBtn" onclick="send()" disabled>å‘é€</button>
</div>

<script>
  const username = prompt("è¯·è¾“å…¥ä½ çš„æ˜µç§°");
  const statusDiv = document.getElementById("status");
  const socket = new WebSocket("wss://blackbox-chat.onrender.com");

  socket.onopen = () => {
    log("âœ… å·²è¿æ¥èŠå¤©å®¤", "system");
    document.getElementById("sendBtn").disabled = false;
  };

  socket.onmessage = (e) => {
    try {
      const data = JSON.parse(e.data); // æœåŠ¡å™¨å¦‚æœå‘ JSON
      log(`${data.username}: ${data.msg}`, data.username === username ? "me" : "other");
    } catch {
      // å¦‚æœæ˜¯çº¯æ–‡æœ¬
      log(e.data, "other");
    }
  };

  socket.onerror = () => log("âŒ è¿æ¥å‡ºé”™", "system");

  function send() {
    const msgInput = document.getElementById("msg");
    const msg = msgInput.value;
    if (msg.trim()) {
      if (socket.readyState === WebSocket.OPEN) {
        socket.send(JSON.stringify({ username, msg }));
        log(`${username}: ${msg}`, "me");
        msgInput.value = "";
      } else {
        log("âš ï¸ è¿æ¥å°šæœªå»ºç«‹", "system");
      }
    }
  }

  function log(message, type = "other") {
    const logDiv = document.getElementById("log");
    const msgDiv = document.createElement("div");
    msgDiv.className = `msg ${type}`;
    msgDiv.textContent = message;
    logDiv.appendChild(msgDiv);
    logDiv.scrollTop = logDiv.scrollHeight;
  }

  function insertEmoji() {
    const msgInput = document.getElementById("msg");
    msgInput.value += "ğŸ˜Š";
    msgInput.focus();
  }

  function startCall() {
    alert("ğŸ“ æ­£åœ¨æ‹‰èµ·è¯­éŸ³é€šè¯...");
    // è¿™é‡Œå¯æ”¹æˆçœŸæ­£çš„ WebRTC å‘¼å«é€»è¾‘
  }
</script>

</body>
</html>
