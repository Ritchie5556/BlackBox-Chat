<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<title>èŠå¤©å®¤</title>
<style>
  :root {
    --sunset-yellow: #FFD166;
    --light-red: #EF476F;
    --warm-orange: #F78C6B;
    --cool-teal: #06D6A0;
    --light-purple: #9B5DE5;
    --light-pink: #FEC5E5;
  }

  body {
    margin: 0;
    font-family: Arial, sans-serif;
    height: 100vh;
    display: flex;
    flex-direction: column;
    background: linear-gradient(
      135deg, 
      var(--sunset-yellow) 0%, 
      var(--light-red) 20%, 
      var(--warm-orange) 40%, 
      var(--cool-teal) 60%, 
      var(--light-purple) 80%, 
      var(--light-pink) 100%
    );
  }

  /* é¡¶éƒ¨æ  */
  .top-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px;
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    color: white;
    font-weight: bold;
  }

  .top-bar .left, .top-bar .right {
    cursor: pointer;
    font-size: 20px;
    padding: 0 10px;
  }

  .top-bar .center {
    flex: 1;
    text-align: center;
  }

  /* èŠå¤©è®°å½• */
  #log {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
  }

  .msg {
    max-width: 70%;
    padding: 10px;
    margin: 5px 0;
    border-radius: 10px;
    background: rgba(255,255,255,0.8);
    word-wrap: break-word;
    clear: both;
  }

  .msg.me {
    background: rgba(255,255,255,0.9);
    float: right;
    text-align: right;
  }

  .msg.other {
    background: rgba(255,255,255,0.7);
    float: left;
    text-align: left;
  }

  /* åº•éƒ¨è¾“å…¥æ  */
  .bottom-bar {
    display: flex;
    padding: 10px;
    background: rgba(255,255,255,0.3);
    backdrop-filter: blur(5px);
    align-items: center;
  }

  #msg {
    flex: 1;
    padding: 8px;
    border: none;
    border-radius: 20px;
    outline: none;
    margin: 0 5px;
  }

  button {
    padding: 8px 15px;
    border: none;
    border-radius: 20px;
    background: #fff;
    cursor: pointer;
  }

  .emoji-btn {
    font-size: 20px;
    background: transparent;
  }

  /* è¡¨æƒ…é€‰æ‹©æ¡† */
  #emoji-picker {
    display: none;
    position: absolute;
    bottom: 60px;
    left: 10px;
    background: rgba(255,255,255,0.95);
    border-radius: 10px;
    padding: 10px;
    max-width: 200px;
    flex-wrap: wrap;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  }

  #emoji-picker span {
    font-size: 20px;
    margin: 5px;
    cursor: pointer;
  }
</style>
</head>
<body>

<!-- é¡¶éƒ¨æ  -->
<div class="top-bar">
  <div class="left" onclick="goHome()">ğŸ </div>
  <div class="center" id="status">å¯¹æ–¹æ˜µç§°ï¼ˆåœ¨çº¿ï¼‰</div>
  <div class="right" onclick="startCall()">ğŸ“</div>
</div>

<!-- èŠå¤©è®°å½• -->
<div id="log"></div>

<!-- è¡¨æƒ…é€‰æ‹© -->
<div id="emoji-picker"></div>

<!-- åº•éƒ¨æ  -->
<div class="bottom-bar">
  <button class="emoji-btn" onclick="toggleEmoji()">ğŸ˜Š</button>
  <input id="msg" placeholder="è¾“å…¥æ¶ˆæ¯..." />
  <button id="sendBtn" onclick="send()" disabled>å‘é€</button>
</div>

<script>
  const username = prompt("è¯·è¾“å…¥ä½ çš„æ˜µç§°");
  const socket = new WebSocket("ws://localhost:8080"); // æ”¹æˆæœåŠ¡å™¨åœ°å€

  const emojiList = ["ğŸ˜€","ğŸ˜","ğŸ˜‚","ğŸ¤£","ğŸ˜Š","ğŸ˜","ğŸ˜˜","ğŸ˜","ğŸ˜­","ğŸ˜¡","ğŸ‘","ğŸ™","ğŸ”¥","ğŸ‰","â¤ï¸","ğŸ’”"];
  const emojiPicker = document.getElementById("emoji-picker");
  emojiList.forEach(e => {
    const span = document.createElement("span");
    span.textContent = e;
    span.onclick = () => {
      document.getElementById("msg").value += e;
      emojiPicker.style.display = "none";
    };
    emojiPicker.appendChild(span);
  });

  function toggleEmoji() {
    emojiPicker.style.display = emojiPicker.style.display === "flex" ? "none" : "flex";
    emojiPicker.style.flexWrap = "wrap";
  }

  socket.onopen = () => {
    log("âœ… å·²è¿æ¥èŠå¤©å®¤", "system");
    document.getElementById("sendBtn").disabled = false;
  };

  socket.onmessage = (e) => {
    const data = JSON.parse(e.data); // æœåŠ¡ç«¯ä¿è¯æ˜¯ JSON
    log(`${data.username}: ${data.msg}`, data.username === username ? "me" : "other");
  };

  socket.onerror = () => log("âŒ è¿æ¥å‡ºé”™", "system");

  function send() {
    const msg = document.getElementById("msg").value;
    if (msg.trim()) {
      if (socket.readyState === WebSocket.OPEN) {
        socket.send(JSON.stringify({ username, msg }));
        document.getElementById("msg").value = "";
      } else {
        log("âš ï¸ è¿æ¥å°šæœªå»ºç«‹", "system");
      }
    }
  }

  function log(message, type) {
    const logDiv = document.getElementById("log");
    const div = document.createElement("div");
    div.className = "msg " + (type || "other");
    div.innerHTML = message;
    logDiv.appendChild(div);
    logDiv.scrollTop = logDiv.scrollHeight;
  }

  function goHome() {
    window.location.href = "/"; // è¿”å›ä¸»é¡µ
  }

  function startCall() {
    alert("ğŸ“ è¯­éŸ³é€šè¯åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...");
    // å¯é›†æˆ WebRTC
  }
</script>

</body>
</html>
