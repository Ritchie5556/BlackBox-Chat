<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>èŠå¤©å®¤</title>
<style>
  :root {
    --sunset-yellow: #FFD54F;
    --light-red: #FF8A80;
    --warm-orange: #FFB74D;
    --cool-teal: #4DB6AC;
    --light-purple: #BA68C8;
    --light-pink: #F48FB1;
  }
  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, var(--sunset-yellow) 0%, var(--light-red) 20%, var(--warm-orange) 40%, var(--cool-teal) 60%, var(--light-purple) 80%, var(--light-pink) 100%);
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  .top-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: rgba(255,255,255,0.2);
    padding: 10px 15px;
    color: #fff;
    font-weight: bold;
    backdrop-filter: blur(5px);
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  }
  .top-center {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .top-center img {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid rgba(255,255,255,0.5);
  }
  .top-bar button {
    background: rgba(255,255,255,0.3);
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    font-size: 18px;
    cursor: pointer;
    color: #fff;
    transition: all 0.3s ease;
  }
  .top-bar button:hover {
    background: rgba(255,255,255,0.5);
    transform: scale(1.1);
  }
  #log {
    flex: 1;
    padding: 15px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
  }
  .msg {
    max-width: 70%;
    padding: 10px 15px;
    margin: 8px 0;
    border-radius: 18px;
    color: #333;
    background: rgba(255,255,255,0.8);
    word-wrap: break-word;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    animation: fadeIn 0.3s ease;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .me { 
    background: #DCF8C6; 
    align-self: flex-end; 
  }
  .other { 
    background: rgba(255,255,255,0.9); 
    align-self: flex-start; 
  }
  .system { 
    background: rgba(200,200,200,0.7); 
    text-align: center; 
    color: #000; 
    font-style: italic;
    max-width: 90%;
    margin: 8px auto;
  }
  .input-area {
    display: flex;
    padding: 15px;
    background: rgba(255,255,255,0.2);
    backdrop-filter: blur(5px);
    position: relative;
    gap: 10px;
  }
  #msg { 
    flex: 1; 
    padding: 12px 15px; 
    border: none; 
    border-radius: 24px; 
    outline: none; 
    font-size: 16px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  #sendBtn, #emojiBtn { 
    padding: 10px 20px; 
    border: none; 
    border-radius: 24px; 
    cursor: pointer; 
    background: rgba(255,255,255,0.9);
    font-weight: bold;
    transition: all 0.3s ease;
  }
  #sendBtn:hover, #emojiBtn:hover {
    background: rgba(255,255,255,1);
    transform: scale(1.05);
  }
  #sendBtn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }

  /* è¡¨æƒ…é¢æ¿ */
  #emojiPanel {
    position: absolute;
    bottom: 70px;
    right: 15px;
    background: rgba(255,255,255,0.95);
    border-radius: 12px;
    padding: 10px;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    width: 300px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    z-index: 100;
  }
  #emojiPanel button {
    font-size: 24px;
    border: none;
    background: none;
    cursor: pointer;
    padding: 5px;
    border-radius: 5px;
    transition: background 0.2s;
  }
  #emojiPanel button:hover {
    background: rgba(0,0,0,0.1);
  }
  /* çŠ¶æ€æ ·å¼ */
  .status {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 14px;
    color: #fff;
  }
  .status-circle {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    animation: breathe 2s infinite ease-in-out;
  }

  @keyframes breathe {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.5); opacity: 0.6; }
  }

  /* æ ¹æ®ä¸åŒçŠ¶æ€åŠ¨æ€ä¿®æ”¹é¢œè‰²å’ŒåŠ¨ç”»æ—¶é—´ */
  .online { background: #4CAF50; animation-duration: 2s; }
  .offline { background: #9E9E9E; animation-duration: 3s; }
  .busy { background: #FFC107; animation-duration: 1s; }
  
  /* é€šè¯ç•Œé¢æ ·å¼ */
  #callOverlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(10px);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }

  #callStatus {
    margin-bottom: 20px;
    color: #fff;
    font-size: 24px;
    text-align: center;
  }
  
  #callTimer {
    font-size: 28px;
    font-weight: bold;
    color: #fff;
    margin: 15px 0;
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
  }
  
  .call-buttons {
    display: flex;
    gap: 20px;
    margin-top: 30px;
  }
  
  .call-button {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: none;
    font-size: 24px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    transition: all 0.3s ease;
  }
  
  .call-button:hover {
    transform: scale(1.1);
  }
  
  #acceptCall {
    background: #4CAF50;
    color: white;
  }
  
  #endCall {
    background: #F44336;
    color: white;
  }
  
  .caller-info {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 30px;
  }
  
  .caller-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid white;
    margin-bottom: 15px;
  }
  
  .caller-name {
    color: white;
    font-size: 20px;
    font-weight: bold;
  }
</style>
</head>
<body>

<div class="top-bar">
  <button onclick="goHome()">ğŸ </button>
  <div class="top-center">
    <img id="partnerAvatar" src="https://ui-avatars.com/api/?name=User&background=random" alt="å¯¹æ–¹å¤´åƒ">
    <span id="partnerName">æœªçŸ¥ç”¨æˆ·</span>
    <div id="partnerStatus" class="status">
      <div id="statusCircle" class="status-circle offline"></div>
      <span id="statusText">ç¦»çº¿</span>
    </div>
  </div>
  <button onclick="startCall()">ğŸ“</button>
</div>

<div id="log">
  <div class="msg system">æ¬¢è¿æ¥åˆ°èŠå¤©å®¤ï¼è¯·è¾“å…¥æ‚¨çš„æ˜µç§°å¼€å§‹èŠå¤©ã€‚</div>
</div>

<div class="input-area">
  <input id="msg" placeholder="è¾“å…¥æ¶ˆæ¯..." />
  <button id="emojiBtn" onclick="toggleEmojiPanel()">ğŸ˜Š</button>
  <button id="sendBtn" onclick="sendMessage()" disabled>å‘é€</button>
</div>

<script>
  // ç®€åŒ–ç‰ˆæœ¬ - ç§»é™¤æœ‰é—®é¢˜çš„å¤æ‚åŠŸèƒ½
  document.addEventListener('DOMContentLoaded', function() {
    // åˆå§‹åŒ–å˜é‡
    let userName = '';
    let partnerInfo = { 
      name: "æœªçŸ¥ç”¨æˆ·", 
      avatar: "https://ui-avatars.com/api/?name=User&background=random", 
      online: false 
    };
    
    // è¯·æ±‚ç”¨æˆ·è¾“å…¥åç§°
    getUserName();
    
    // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
    document.getElementById('msg').addEventListener('input', function() {
      const sendBtn = document.getElementById('sendBtn');
      sendBtn.disabled = this.value.trim() === '';
    });
    
    document.getElementById('msg').addEventListener('keypress', function(e) {
      if (e.key === 'Enter' && !sendBtn.disabled) {
        sendMessage();
      }
    });
    
    // æ¨¡æ‹Ÿè¿æ¥çŠ¶æ€å˜åŒ–
    simulateConnectionStatus();
  });
  
  // è·å–ç”¨æˆ·å
  function getUserName() {
    let name = '';
    while(!name || name.trim() === '') {
      name = prompt("è¯·è¾“å…¥ä½ çš„æ˜µç§°:") || "åŒ¿åç”¨æˆ·";
    }
    window.userName = name;
    addSystemMessage(`ä½ å¥½ï¼Œ${name}! è¿™æ˜¯ä¸€ä¸ªæ¼”ç¤ºç‰ˆæœ¬ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½æ— æ³•ä½¿ç”¨ã€‚`);
  }
  
  // æ·»åŠ ç³»ç»Ÿæ¶ˆæ¯
  function addSystemMessage(message) {
    const logDiv = document.getElementById("log");
    const msgDiv = document.createElement("div");
    msgDiv.className = "msg system";
    msgDiv.textContent = message;
    logDiv.appendChild(msgDiv);
    logDiv.scrollTop = logDiv.scrollHeight;
  }
  
  // å‘é€æ¶ˆæ¯
  function sendMessage() {
    const msgInput = document.getElementById("msg");
    const message = msgInput.value.trim();
    
    if (!message) return;
    
    // æ·»åŠ è‡ªå·±çš„æ¶ˆæ¯åˆ°èŠå¤©è®°å½•
    addMessage(message, 'me');
    
    // æ¨¡æ‹Ÿå¯¹æ–¹å›å¤ï¼ˆä»…æ¼”ç¤ºç”¨ï¼‰
    if (Math.random() > 0.5) {
      setTimeout(() => {
        const replies = [
          "ä½ å¥½ï¼",
          "å¾ˆé«˜å…´æ”¶åˆ°ä½ çš„æ¶ˆæ¯ï¼",
          "æˆ‘ç°åœ¨æ— æ³•å›å¤ï¼Œç¨åè”ç³»ä½ ã€‚",
          "è°¢è°¢ä½ çš„æ¶ˆæ¯ï¼",
          "è¿™æ˜¯ä¸€ä¸ªè‡ªåŠ¨å›å¤ã€‚"
        ];
        const randomReply = replies[Math.floor(Math.random() * replies.length)];
        addMessage(randomReply, 'other');
        setPartnerStatus('online');
      }, 1000 + Math.random() * 2000);
    }
    
    // æ¸…ç©ºè¾“å…¥æ¡†
    msgInput.value = '';
    document.getElementById('sendBtn').disabled = true;
  }
  
  // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©è®°å½•
  function addMessage(message, type) {
    const logDiv = document.getElementById("log");
    const msgDiv = document.createElement("div");
    msgDiv.className = `msg ${type}`;
    msgDiv.textContent = message;
    logDiv.appendChild(msgDiv);
    logDiv.scrollTop = logDiv.scrollHeight;
  }
  
  // è®¾ç½®å¯¹æ–¹çŠ¶æ€
  function setPartnerStatus(state) {
    const circle = document.getElementById("statusCircle");
    const text = document.getElementById("statusText");
    
    circle.className = "status-circle " + state;
    
    if (state === "online") {
      text.textContent = "åœ¨çº¿";
      partnerInfo.online = true;
    } else if (state === "offline") {
      text.textContent = "ç¦»çº¿";
      partnerInfo.online = false;
    } else if (state === "busy") {
      text.textContent = "ç¹å¿™";
      partnerInfo.online = true;
    }
  }
  
  // æ¨¡æ‹Ÿè¿æ¥çŠ¶æ€å˜åŒ–
  function simulateConnectionStatus() {
    setInterval(() => {
      const states = ["online", "offline", "busy"];
      const randomState = states[Math.floor(Math.random() * states.length)];
      setPartnerStatus(randomState);
    }, 10000);
  }
  
  // è¡¨æƒ…é¢æ¿åŠŸèƒ½
  function toggleEmojiPanel() {
    let panel = document.getElementById('emojiPanel');
    
    if (panel) { 
      panel.remove(); 
      return; 
    }
    
    panel = document.createElement('div');
    panel.id = 'emojiPanel';
    
    const emojis = ['ğŸ˜€', 'ğŸ˜ƒ', 'ğŸ˜„', 'ğŸ˜', 'ğŸ˜†', 'ğŸ˜…', 'ğŸ˜‚', 'ğŸ¤£', 'ğŸ˜Š', 'ğŸ˜‡', 'ğŸ™‚', 'ğŸ™ƒ', 'ğŸ˜‰', 'ğŸ˜Œ', 'ğŸ˜', 'ğŸ¥°', 'ğŸ˜˜', 'ğŸ˜—', 'ğŸ˜™', 'ğŸ˜š', 'ğŸ˜‹', 'ğŸ˜›', 'ğŸ˜', 'ğŸ˜œ', 'ğŸ¤ª', 'ğŸ¤¨', 'ğŸ§', 'ğŸ¤“', 'ğŸ˜', 'ğŸ¤©', 'ğŸ¥³', 'ğŸ˜', 'ğŸ˜’', 'ğŸ˜', 'ğŸ˜”', 'ğŸ˜Ÿ', 'ğŸ˜•', 'ğŸ™', 'â˜¹ï¸', 'ğŸ˜£', 'ğŸ˜–', 'ğŸ˜«', 'ğŸ˜©', 'ğŸ¥º', 'ğŸ˜¢', 'ğŸ˜­', 'ğŸ˜¤', 'ğŸ˜ ', 'ğŸ˜¡', 'ğŸ¤¬', 'ğŸ¤¯', 'ğŸ˜³', 'ğŸ¥µ', 'ğŸ¥¶', 'ğŸ˜±', 'ğŸ˜¨', 'ğŸ˜°', 'ğŸ˜¥', 'ğŸ˜“', 'ğŸ«£', 'ğŸ¤—', 'ğŸ«¡', 'ğŸ¤”', 'ğŸ«¢', 'ğŸ¤­', 'ğŸ¤«', 'ğŸ¤¥', 'ğŸ˜¶', 'ğŸ« ', 'ğŸ˜', 'ğŸ«¤', 'ğŸ˜‘', 'ğŸ˜¬', 'ğŸ™„', 'ğŸ˜¯', 'ğŸ˜¦', 'ğŸ˜§', 'ğŸ˜®', 'ğŸ˜²', 'ğŸ¥±', 'ğŸ˜´', 'ğŸ¤¤', 'ğŸ˜ª', 'ğŸ˜µ', 'ğŸ«¥', 'ğŸ¤', 'ğŸ¥´', 'ğŸ¤¢', 'ğŸ¤®', 'ğŸ¤§', 'ğŸ˜·', 'ğŸ¤’', 'ğŸ¤•', 'ğŸ¤‘', 'ğŸ¤ ', 'ğŸ˜ˆ', 'ğŸ‘¿', 'ğŸ‘¹', 'ğŸ‘º', 'ğŸ¤¡', 'ğŸ’©', 'ğŸ‘»', 'ğŸ’€', 'â˜ ï¸', 'ğŸ‘½', 'ğŸ‘¾', 'ğŸ¤–', 'ğŸƒ', 'ğŸ˜º', 'ğŸ˜¸', 'ğŸ˜¹', 'ğŸ˜»', 'ğŸ˜¼', 'ğŸ˜½', 'ğŸ™€', 'ğŸ˜¿', 'ğŸ˜¾'];
    
    emojis.forEach(emoji => {
      const btn = document.createElement('button');
      btn.innerText = emoji;
      btn.onclick = () => insertEmoji(emoji);
      panel.appendChild(btn);
    });
    
    document.querySelector('.input-area').appendChild(panel);
  }
  
  // æ’å…¥è¡¨æƒ…
  function insertEmoji(symbol) {
    const msgInput = document.getElementById("msg");
    msgInput.value += symbol;
    msgInput.focus();
    document.getElementById('sendBtn').disabled = false;
  }
  
  // ä¸»é¡µæŒ‰é’®åŠŸèƒ½
  function goHome() {
    if (confirm("ç¡®å®šè¦ç¦»å¼€èŠå¤©å®¤å—ï¼Ÿ")) {
      addSystemMessage("æ‚¨å·²ç¦»å¼€èŠå¤©å®¤");
      // åœ¨å®é™…åº”ç”¨ä¸­è¿™é‡Œä¼šè¿›è¡Œæ–­å¼€è¿æ¥ç­‰æ“ä½œ
    }
  }
  
  // å¼€å§‹é€šè¯åŠŸèƒ½ï¼ˆç®€åŒ–ç‰ˆï¼‰
  function startCall() {
    if (!partnerInfo.online) {
      alert("å¯¹æ–¹ä¸åœ¨çº¿ï¼Œæ— æ³•å‘èµ·é€šè¯");
      return;
    }
    
    if (confirm("ç¡®å®šè¦å‘èµ·è¯­éŸ³é€šè¯å—ï¼Ÿ")) {
      showCallOverlay(false);
      addSystemMessage("å·²å‘èµ·é€šè¯è¯·æ±‚...");
      
      // æ¨¡æ‹Ÿå¯¹æ–¹åœ¨10ç§’åæ¥å¬
      setTimeout(() => {
        if (Math.random() > 0.3) {
          document.getElementById('callStatus').textContent = "é€šè¯ä¸­...";
          startCallTimer();
        } else {
          endCall();
          addSystemMessage("å¯¹æ–¹æ‹’ç»äº†é€šè¯è¯·æ±‚");
        }
      }, 3000);
    }
  }
  
  // æ˜¾ç¤ºé€šè¯ç•Œé¢
  function showCallOverlay(isIncoming) {
    const overlay = document.createElement('div');
    overlay.id = 'callOverlay';
    
    const callerInfo = document.createElement('div');
    callerInfo.className = 'caller-info';
    
    const avatar = document.createElement('img');
    avatar.src = partnerInfo.avatar;
    avatar.alt = partnerInfo.name;
    avatar.className = 'caller-avatar';
    
    const name = document.createElement('div');
    name.className = 'caller-name';
    name.textContent = partnerInfo.name;
    
    callerInfo.appendChild(avatar);
    callerInfo.appendChild(name);
    
    const status = document.createElement('div');
    status.id = 'callStatus';
    status.textContent = isIncoming ? 'æ¥ç”µä¸­...' : 'å‘¼å«ä¸­...';
    
    const timer = document.createElement('div');
    timer.id = 'callTimer';
    timer.textContent = '00:00:00';
    
    const buttons = document.createElement('div');
    buttons.className = 'call-buttons';
    
    if (isIncoming) {
      const acceptBtn = document.createElement('button');
      acceptBtn.id = 'acceptCall';
      acceptBtn.innerHTML = 'ğŸ“';
      acceptBtn.title = 'æ¥å¬';
      acceptBtn.onclick = acceptCall;
      buttons.appendChild(acceptBtn);
    }
    
    const endBtn = document.createElement('button');
    endBtn.id = 'endCall';
    endBtn.innerHTML = 'ğŸ“';
    endBtn.title = 'æŒ‚æ–­';
    endBtn.onclick = endCall;
    buttons.appendChild(endBtn);
    
    overlay.appendChild(callerInfo);
    overlay.appendChild(status);
    overlay.appendChild(timer);
    overlay.appendChild(buttons);
    
    document.body.appendChild(overlay);
  }
  
  // æ¥å¬é€šè¯
  function acceptCall() {
    document.getElementById('callStatus').textContent = "é€šè¯ä¸­...";
    startCallTimer();
    addSystemMessage("å·²æ¥å¬é€šè¯");
  }
  
  // ç»“æŸé€šè¯
  function endCall() {
    const overlay = document.getElementById('callOverlay');
    if (overlay) {
      overlay.remove();
    }
    stopCallTimer();
    addSystemMessage("é€šè¯å·²ç»“æŸ");
  }
  
  // é€šè¯è®¡æ—¶å™¨å˜é‡
  let callTimerInterval = null;
  let callStartTime = null;
  
  // å¯åŠ¨é€šè¯è®¡æ—¶å™¨
  function startCallTimer() {
    // æ¸…é™¤ç°æœ‰çš„è®¡æ—¶å™¨ï¼ˆå¦‚æœæœ‰ï¼‰
    if (callTimerInterval) {
      clearInterval(callTimerInterval);
    }
    
    // è®°å½•é€šè¯å¼€å§‹æ—¶é—´
    callStartTime = new Date();
    
    // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
    updateCallTimer();
    
    // æ¯ç§’æ›´æ–°ä¸€æ¬¡è®¡æ—¶å™¨
    callTimerInterval = setInterval(updateCallTimer, 1000);
  }

  // æ›´æ–°é€šè¯è®¡æ—¶å™¨æ˜¾ç¤º
  function updateCallTimer() {
    const timerElement = document.getElementById('callTimer');
    if (!timerElement) return;
    
    // è®¡ç®—é€šè¯æ—¶é•¿ï¼ˆç§’ï¼‰
    const now = new Date();
    const elapsedSeconds = Math.floor((now - callStartTime) / 1000);
    
    // æ ¼å¼åŒ–ä¸ºHH:MM:SS
    const hours = Math.floor(elapsedSeconds / 3600);
    const minutes = Math.floor((elapsedSeconds % 3600) / 60);
    const seconds = elapsedSeconds % 60;
    
    // æ›´æ–°æ˜¾ç¤º
    timerElement.textContent = 
      `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
  }

  // åœæ­¢é€šè¯è®¡æ—¶å™¨
  function stopCallTimer() {
    if (callTimerInterval) {
      clearInterval(callTimerInterval);
      callTimerInterval = null;
    }
  }
</script>

</body>
</html>
