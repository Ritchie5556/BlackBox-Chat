<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<title>聊天室</title>
<style>
  :root {
    --sunset-yellow: #FFD54F;
    --light-red: #FF8A80;
    --warm-orange: #FFB74D;
    --cool-teal: #4DB6AC;
    --light-purple: #BA68C8;
    --light-pink: #F48FB1;
  }
  body {
    margin: 0;
    font-family: sans-serif;
    background: linear-gradient(135deg, var(--sunset-yellow) 0%, var(--light-red) 20%, var(--warm-orange) 40%, var(--cool-teal) 60%, var(--light-purple) 80%, var(--light-pink) 100%);
    height: 100vh;
    display: flex;
    flex-direction: column;
  }
  /* 顶部栏 */
  .top-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: rgba(255,255,255,0.2);
    padding: 10px;
    color: #fff;
    font-weight: bold;
    backdrop-filter: blur(5px);
  }
  .top-bar button {
    background: none;
    border: none;
    font-size: 20px;
    cursor: pointer;
    color: #fff;
  }
  /* 消息区域 */
  #log {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
  }
  .msg {
    max-width: 70%;
    padding: 8px 12px;
    margin: 5px 0;
    border-radius: 12px;
    color: #000;
    background: rgba(255,255,255,0.8);
    word-wrap: break-word;
  }
  .me {
    background: rgba(255,255,255,0.9);
    align-self: flex-end;
  }
  .other {
    background: rgba(255,255,255,0.6);
    align-self: flex-start;
  }
  /* 输入区 */
  .input-area {
    display: flex;
    padding: 10px;
    background: rgba(255,255,255,0.2);
    backdrop-filter: blur(5px);
  }
  #msg {
    flex: 1;
    padding: 8px;
    border: none;
    border-radius: 20px;
    outline: none;
  }
  #sendBtn, #emojiBtn {
    margin-left: 5px;
    padding: 8px 12px;
    border: none;
    border-radius: 20px;
    cursor: pointer;
    background: rgba(255,255,255,0.9);
  }
</style>
</head>
<body>

<!-- 顶部栏 -->
<div class="top-bar">
  <button onclick="window.location.href='/'">🏠</button>
  <div id="status">对方：离线</div>
  <button onclick="startCall()">📞</button>
</div>

<!-- 消息记录 -->
<div id="log" style="display:flex;flex-direction:column;"></div>

<!-- 输入框 -->
<div class="input-area">
  <input id="msg" placeholder="输入消息..." />
  <button id="emojiBtn" onclick="insertEmoji()">😊</button>
  <button id="sendBtn" onclick="send()" disabled>发送</button>
</div>

<script>
  const username = prompt("请输入你的昵称");
  const statusDiv = document.getElementById("status");
  const socket = new WebSocket("wss://blackbox-chat.onrender.com");

  socket.onopen = () => {
    log("✅ 已连接聊天室", "system");
    document.getElementById("sendBtn").disabled = false;
  };

  socket.onmessage = (e) => {
    try {
      const data = JSON.parse(e.data); // 服务器如果发 JSON
      log(`${data.username}: ${data.msg}`, data.username === username ? "me" : "other");
    } catch {
      // 如果是纯文本
      log(e.data, "other");
    }
  };

  socket.onerror = () => log("❌ 连接出错", "system");

  function send() {
    const msgInput = document.getElementById("msg");
    const msg = msgInput.value;
    if (msg.trim()) {
      if (socket.readyState === WebSocket.OPEN) {
        socket.send(JSON.stringify({ username, msg }));
        log(`${username}: ${msg}`, "me");
        msgInput.value = "";
      } else {
        log("⚠️ 连接尚未建立", "system");
      }
    }
  }

  function log(message, type = "other") {
    const logDiv = document.getElementById("log");
    const msgDiv = document.createElement("div");
    msgDiv.className = `msg ${type}`;
    msgDiv.textContent = message;
    logDiv.appendChild(msgDiv);
    logDiv.scrollTop = logDiv.scrollHeight;
  }

  function insertEmoji() {
    const msgInput = document.getElementById("msg");
    msgInput.value += "😊";
    msgInput.focus();
  }

  function startCall() {
    alert("📞 正在拉起语音通话...");
    // 这里可改成真正的 WebRTC 呼叫逻辑
  }
</script>

</body>
</html>
